<div class="flex items-center justify-between mb-4">
  <h1 class="text-xl font-bold">Comercios afiliados</h1>
  <a routerLink="/admin/businesses/new" class="px-3 py-2 text-sm rounded bg-indigo-600 text-white">
    Nuevo comercio
  </a>
</div>

<div class="rounded border bg-white">
  <!-- Loading -->
  <div *ngIf="loading$ | async" class="p-4">
    <div class="animate-pulse space-y-3">
      <div class="h-4 bg-slate-200 rounded w-1/3"></div>
      <div class="h-24 bg-slate-200 rounded"></div>
    </div>
  </div>

  <!-- Error -->
  <div *ngIf="!(loading$ | async) && errorMsg" class="p-3 border-t text-sm text-red-700 bg-red-50 border-red-200">
    {{ errorMsg }}
  </div>

  <!-- Table -->
  <div class="overflow-x-auto" *ngIf="!(loading$ | async) && !errorMsg">
    <table class="min-w-full text-sm">
      <thead class="bg-slate-100 text-slate-600">
        <tr>
          <th class="text-left p-3">NIT</th>
          <th class="text-left p-3">Comercial</th>
          <th class="text-left p-3">Razón social</th>
          <th class="text-left p-3">Nivel</th>
          <th class="text-left p-3">Teléfono</th>
          <th class="text-left p-3">Email</th>
          <th class="text-left p-3">Activo</th>
          <th class="p-3 text-right">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let b of items; trackBy: trackById" class="border-t">
          <td class="p-3">{{ b.tax_id }}</td>
          <td class="p-3">{{ b.business_name }}</td>
          <td class="p-3">{{ b.legal_name }}</td>
          <td class="p-3">{{ levelName(b.current_level_id) }}</td>
          <td class="p-3">{{ b.business_phone || '-' }}</td>
          <td class="p-3">{{ b.business_email || '-' }}</td>
          <td class="p-3">
            <button class="px-2 py-1 rounded border text-xs" [class.bg-green-50]="b.active" (click)="toggleActive(b)">
              {{ b.active ? 'Activo' : 'Inactivo' }}
            </button>
          </td>
          <td class="p-3 text-right space-x-2">
            <a class="text-indigo-600 hover:underline" [routerLink]="['/admin/businesses', b.business_id]">Editar</a>
            <button class="text-red-600 hover:underline cursor-pointer" (click)="delete(b.business_id)">Eliminar</button>
          </td>
        </tr>

        <tr *ngIf="!(loading$ | async) && items.length === 0">
          <td colspan="8" class="p-6 text-center text-slate-500">Sin registros</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
