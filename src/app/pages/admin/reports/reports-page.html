<section class="max-w-6xl mx-auto">
  <header class="mb-4">
    <h1 class="text-xl font-bold">Reportes</h1>
    <p class="text-sm text-slate-500">Selecciona el reporte y el rango de fechas.</p>
  </header>

  <form [formGroup]="form" class="rounded border bg-white p-4 grid gap-3 md:grid-cols-5 mb-4">
    <div class="grid gap-1 md:col-span-2">
      <label class="text-xs font-medium">Reporte</label>
      <select formControlName="report" class="rounded border px-2 py-2">
        <option *ngFor="let r of reportKeys" [value]="r.key">{{ r.label }}</option>
      </select>
    </div>
    <div class="grid gap-1">
      <label class="text-xs font-medium">Desde</label>
      <input type="date" formControlName="startDate" class="rounded border px-2 py-2"/>
    </div>
    <div class="grid gap-1">
      <label class="text-xs font-medium">Hasta</label>
      <input type="date" formControlName="endDate" class="rounded border px-2 py-2"/>
    </div>
    <div class="flex items-end gap-2">
      <button type="button" class="px-3 py-2 rounded bg-indigo-600 text-white" (click)="fetch()">Generar</button>
    </div>

    <div class="md:col-span-5 flex gap-2 justify-end">
      <button type="button" class="px-3 py-2 rounded border" (click)="exportPdf()">Exportar PDF</button>
      <button type="button" class="px-3 py-2 rounded border" (click)="exportImage()">Exportar Imagen</button>
      <button type="button" class="px-3 py-2 rounded border" (click)="exportExcel()">Exportar Excel</button>
    </div>
  </form>

  <div class="rounded border bg-white" *ngIf="loading">
    <div class="p-4">
      <div class="animate-pulse space-y-3">
        <div class="h-4 bg-slate-200 rounded w-1/3"></div>
        <div class="h-24 bg-slate-200 rounded"></div>
      </div>
    </div>
  </div>

  <div *ngIf="!loading && errorMsg" class="p-3 rounded border border-red-200 bg-red-50 text-red-700 text-sm">
    {{ errorMsg }}
  </div>

  <div class="rounded border bg-white overflow-x-auto" *ngIf="!loading && !errorMsg">
    <table #reportTable class="min-w-full text-sm" *ngIf="rows.length; else emptyTpl">
      <thead class="bg-slate-100 text-slate-600">
        <tr>
          <th class="text-left p-3" *ngFor="let c of columns">{{ c }}</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let r of rows" class="border-t">
          <td class="p-3" *ngFor="let c of columns">{{ formatCell(r, c) }}</td>
        </tr>
      </tbody>
    </table>

    <ng-template #emptyTpl>
      <div class="p-6 text-center text-slate-500">Sin datos</div>
    </ng-template>
  </div>
</section>
